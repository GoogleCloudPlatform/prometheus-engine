"use strict";var e=require("@csstools/postcss-progressive-custom-properties"),t=require("postcss-value-parser");function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=r(e),u=r(t);
/**
 * Simple matrix (and vector) multiplication
 * Warning: No error handling for incompatible dimensions!
 * @author Lea Verou 2020 MIT License
 *
 * @license W3C
 * https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document
 *
 * @copyright This software or document includes material copied from or derived from https://github.com/w3c/csswg-drafts/blob/main/css-color-4/multiply-matrices.js. Copyright © 2022 W3C® (MIT, ERCIM, Keio, Beihang).
 *
 * @see https://github.com/w3c/csswg-drafts/blob/main/css-color-4/multiply-matrices.js
 */
function a(e,t){const r=e.length;let n,u;n=Array.isArray(e[0])?e:[e],Array.isArray(t[0])||(u=t.map((e=>[e])));const a=u[0].length,o=u[0].map(((e,t)=>u.map((e=>e[t]))));let s=n.map((e=>o.map((t=>Array.isArray(e)?e.reduce(((e,r,n)=>e+r*(t[n]||0)),0):t.reduce(((t,r)=>t+r*e),0)))));return 1===r&&(s=s[0]),1===a?s.map((e=>e[0])):s}
/**
 * @license W3C
 * https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document
 *
 * @copyright This software or document includes material copied from or derived from https://github.com/w3c/csswg-drafts/blob/main/css-color-4/conversions.js. Copyright © 2022 W3C® (MIT, ERCIM, Keio, Beihang).
 *
 * @see https://github.com/w3c/csswg-drafts/blob/main/css-color-4/conversions.js
 */function o(e){return e.map((function(e){const t=e<0?-1:1,r=Math.abs(e);return r<.04045?e/12.92:t*Math.pow((r+.055)/1.055,2.4)}))}function s(e){return e.map((function(e){const t=e<0?-1:1,r=Math.abs(e);return r>.0031308?t*(1.055*Math.pow(r,1/2.4)-.055):12.92*e}))}function c(e){return a([[.41239079926595934,.357584339383878,.1804807884018343],[.21263900587151027,.715168678767756,.07219231536073371],[.01933081871559182,.11919477979462598,.9505321522496607]],e)}function i(e){return a([[3.2409699419045226,-1.537383177570094,-.4986107602930034],[-.9692436362808796,1.8759675015077202,.04155505740717559],[.05563007969699366,-.20397695888897652,1.0569715142428786]],e)}function l(e){return a([[.9554734527042182,-.023098536874261423,.0632593086610217],[-.028369706963208136,1.0099954580058226,.021041398966943008],[.012314001688319899,-.020507696433477912,1.3303659366080753]],e)}function p(e){const t=a([[.8190224432164319,.3619062562801221,-.12887378261216414],[.0329836671980271,.9292868468965546,.03614466816999844],[.048177199566046255,.26423952494422764,.6335478258136937]],e);return a([[.2104542553,.793617785,-.0040720468],[1.9779984951,-2.428592205,.4505937099],[.0259040371,.7827717662,-.808675766]],t.map((e=>Math.cbrt(e))))}function f(e){const t=a([[.9999999984505198,.39633779217376786,.2158037580607588],[1.0000000088817609,-.10556134232365635,-.06385417477170591],[1.0000000546724108,-.08948418209496575,-1.2914855378640917]],e);return a([[1.2268798733741557,-.5578149965554813,.28139105017721583],[-.04057576262431372,1.1122868293970594,-.07171106666151701],[-.07637294974672142,-.4214933239627914,1.5869240244272418]],t.map((e=>e**3)))}function d(e){const t=180*Math.atan2(e[2],e[1])/Math.PI;return[e[0],Math.sqrt(e[1]**2+e[2]**2),t>=0?t:t+360]}function v(e){return[e[0],e[1]*Math.cos(e[2]*Math.PI/180),e[1]*Math.sin(e[2]*Math.PI/180)]}
/**
 * @license W3C
 * https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document
 *
 * @copyright This software or document includes material copied from or derived from https://github.com/w3c/csswg-drafts/blob/main/css-color-4/deltaEOK.js. Copyright © 2022 W3C® (MIT, ERCIM, Keio, Beihang).
 *
 * @see https://github.com/w3c/csswg-drafts/blob/main/css-color-4/deltaEOK.js
 */function h(e,t){const[r,n,u]=e,[a,o,s]=t,c=r-a,i=n-o,l=u-s;return Math.sqrt(c**2+i**2+l**2)}function m(e,t,r){return function(e,t,r){let n=0,u=e[1];const a=e;for(;u-n>1e-4;){const e=b(t(a));h(v(a),v(r(e)))-.02<1e-4?n=a[1]:u=a[1],a[1]=(u+n)/2}return b(t([...a]))}(e,t,r)}function b(e){return e.map((e=>e<0?0:e>1?1:e))}function y(e){const[t,r,n]=e;return t>=-1e-4&&t<=1.0001&&r>=-1e-4&&r<=1.0001&&n>=-1e-4&&n<=1.0001}function g(e){let t=e.slice();t=t.map((function(e){const t=e<0?-1:1,r=Math.abs(e);return t*Math.pow(r,563/256)})),t=a([[.5766690429101305,.1855582379065463,.1882286462349947],[.29734497525053605,.6273635662554661,.07529145849399788],[.02703136138641234,.07068885253582723,.9913375368376388]],t);let r=t.slice();return r=p(r),r=d(r),r[0]<1e-6&&(r=[0,0,0]),r[0]>.999999&&(r=[1,0,0]),t=i(t),t=s(t),y(t)?b(t):m(r,(e=>s(e=i(e=f(e=v(e))))),(e=>d(e=p(e=c(e=o(e))))))}function x(e){let t=e.slice();t=l(t);let r=t.slice();return r=p(r),r=d(r),r[0]<1e-6&&(r=[0,0,0]),r[0]>.999999&&(r=[1,0,0]),t=i(t),t=s(t),y(t)?b(t):m(r,(e=>s(e=i(e=f(e=v(e))))),(e=>d(e=p(e=c(e=o(e))))))}function M(e){let t=e.slice(),r=t.slice();return r=p(r),r=d(r),r[0]<1e-6&&(r=[0,0,0]),r[0]>.999999&&(r=[1,0,0]),t=i(t),t=s(t),y(t)?b(t):m(r,(e=>s(e=i(e=f(e=v(e))))),(e=>d(e=p(e=c(e=o(e))))))}function w(e){let t=e.slice();t=o(t),t=a([[.4865709486482162,.26566769316909306,.1982172852343625],[.2289745640697488,.6917385218365064,.079286914093745],[0,.04511338185890264,1.043944368900976]],t);let r=t.slice();return r=p(r),r=d(r),r[0]<1e-6&&(r=[0,0,0]),r[0]>.999999&&(r=[1,0,0]),t=i(t),t=s(t),y(t)?b(t):m(r,(e=>s(e=i(e=f(e=v(e))))),(e=>d(e=p(e=c(e=o(e))))))}function I(e){let t=e.slice();t=t.map((function(e){const t=e<0?-1:1;return Math.abs(e)<=.03125?e/16:t*Math.pow(e,1.8)})),t=a([[.7977604896723027,.13518583717574031,.0313493495815248],[.2880711282292934,.7118432178101014,8565396060525902e-20],[0,0,.8251046025104601]],t),t=l(t);let r=t.slice();return r=p(r),r=d(r),r[0]<1e-6&&(r=[0,0,0]),r[0]>.999999&&(r=[1,0,0]),t=i(t),t=s(t),y(t)?b(t):m(r,(e=>s(e=i(e=f(e=v(e))))),(e=>d(e=p(e=c(e=o(e))))))}function S(e){let t=e.slice();t=function(e){const t=1.09929682680944;return e.map((function(e){const r=e<0?-1:1,n=Math.abs(e);return n<.08124285829863151?e/4.5:r*Math.pow((n+t-1)/t,1/.45)}))}(t),t=a([[.6369580483012914,.14461690358620832,.1688809751641721],[.2627002120112671,.6779980715188708,.05930171646986196],[0,.028072693049087428,1.060985057710791]],t);let r=t.slice();return r=p(r),r=d(r),r[0]<1e-6&&(r=[0,0,0]),r[0]>.999999&&(r=[1,0,0]),t=i(t),t=s(t),y(t)?b(t):m(r,(e=>s(e=i(e=f(e=v(e))))),(e=>d(e=p(e=c(e=o(e))))))}function k(e){let t=e.slice();t=c(t);let r=t.slice();return r=p(r),r=d(r),r[0]<1e-6&&(r=[0,0,0]),r[0]>.999999&&(r=[1,0,0]),t=i(t),t=s(t),y(t)?b(t):m(r,(e=>s(e=i(e=f(e=v(e))))),(e=>d(e=p(e=c(e=o(e))))))}function P(e){let t=e.slice();t=o(t),t=c(t);let r=t.slice();return r=p(r),r=d(r),r[0]<1e-6&&(r=[0,0,0]),r[0]>.999999&&(r=[1,0,0]),t=i(t),t=s(t),y(t)?b(t):m(r,(e=>s(e=i(e=f(e=v(e))))),(e=>d(e=p(e=c(e=o(e))))))}function z(e,t,r,n){const a=u.default.stringify(e),o=e.value,s=e.nodes.slice().filter((e=>"comment"!==e.type&&"space"!==e.type));let c,i=null;if("color"===o&&(i=function(e){if(!function(e){if(!e||"word"!==e.type)return!1;switch(e.value){case"srgb":case"srgb-linear":case"display-p3":case"a98-rgb":case"prophoto-rgb":case"rec2020":case"xyz-d50":case"xyz-d65":case"xyz":return!0;default:return!1}}(e[0]))return null;const t={colorSpace:e[0].value,colorSpaceNode:e[0],parameters:[]};for(let r=1;r<e.length;r++)if(F(e[r]))t.slash=e[r];else{if(t.slash&&(E(e[r])||A(e[r])||q(e[r]))){t.alpha=e[r];break}if(!t.colorSpace.startsWith("xyz")&&E(e[r])){const n=u.default.unit(e[r].value);"%"===n.unit&&(n.number=String(parseFloat(n.number)/100),n.unit="",e[r].value=String(n.number)),t.parameters.push({value:n,node:e[r]})}else{if(!t.colorSpace.startsWith("xyz")||!E(e[r]))return null;{const n=u.default.unit(e[r].value);if(""!==n.unit)return null;t.parameters.push({value:n,node:e[r]})}}}if(0===t.parameters.length)return t;t.parameters.length<3&&(t.parameters=[...t.parameters,{node:{sourceIndex:0,sourceEndIndex:1,value:"0",type:"word"},value:{number:"0",unit:""}},{node:{sourceIndex:0,sourceEndIndex:1,value:"0",type:"word"},value:{number:"0",unit:""}}]);t.parameters.length>3&&(t.parameters=t.parameters.slice(0,3));return t}(s)),!i)return;switch(e.value="rgb",function(e,t,r){if(!t||!r)return;if(e.value="rgba",t.value=",",t.before="",!function(e){if(!e||"word"!==e.type)return!1;if(!O(e))return!1;const t=u.default.unit(e.value);if(!t)return!1;return!!t.number}(r))return;const n=u.default.unit(r.value);if(!n)return;"%"===n.unit&&(n.number=String(parseFloat(n.number)/100),r.value=String(n.number))}(e,i.slash,i.alpha),i.colorSpace){case"srgb":c=P;break;case"srgb-linear":c=k;break;case"a98-rgb":c=g;break;case"prophoto-rgb":c=I;break;case"display-p3":c=w;break;case"rec2020":c=S;break;case"xyz-d50":c=x;break;case"xyz-d65":case"xyz":c=M;break;default:return}const l=(p=i,p.parameters.map((e=>e.value))).map((e=>parseFloat(e.number)));var p;const f=c(l);!y(l)&&n&&t.warn(r,`"${a}" is out of gamut for "${i.colorSpace}". Given "preserve: true" is set, this will lead to unexpected results in some browsers.`),e.nodes=[{sourceIndex:0,sourceEndIndex:1,value:String(Math.round(255*f[0])),type:"word"},{sourceIndex:0,sourceEndIndex:1,value:",",type:"div",before:"",after:""},{sourceIndex:0,sourceEndIndex:1,value:String(Math.round(255*f[1])),type:"word"},{sourceIndex:0,sourceEndIndex:1,value:",",type:"div",before:"",after:""},{sourceIndex:0,sourceEndIndex:1,value:String(Math.round(255*f[2])),type:"word"}],i.alpha&&(e.nodes.push({sourceIndex:0,sourceEndIndex:1,value:",",type:"div",before:"",after:""}),e.nodes.push(i.alpha))}function E(e){if(!e||"word"!==e.type)return!1;if(!O(e))return!1;const t=u.default.unit(e.value);return!!t&&("%"===t.unit||""===t.unit)}function A(e){return e&&"function"===e.type&&"calc"===e.value}function q(e){return e&&"function"===e.type&&"var"===e.value}function F(e){return e&&"div"===e.type&&"/"===e.value}function O(e){if(!e||!e.value)return!1;try{return!1!==u.default.unit(e.value)}catch(e){return!1}}const j=e=>{const t="preserve"in Object(e)&&Boolean(e.preserve);return{postcssPlugin:"postcss-color-function",Declaration:(e,{result:r})=>{if(function(e){const t=e.parent;if(!t)return!1;const r=t.index(e);for(let n=0;n<r;n++){const r=t.nodes[n];if("decl"===r.type&&r.prop===e.prop)return!0}return!1}(e))return;if(function(e){let t=e.parent;for(;t;)if("atrule"===t.type){if("supports"===t.name&&-1!==t.params.indexOf("color("))return!0;t=t.parent}else t=t.parent;return!1}(e))return;const n=e.value;if(-1===n.indexOf("color("))return;const a=function(e,t,r,n){let a;try{a=u.default(e)}catch(n){t.warn(r,`Failed to parse value '${e}' as a color function. Leaving the original value intact.`)}if(void 0===a)return;a.walk((e=>{e.type&&"function"===e.type&&"color"===e.value&&z(e,t,r,n)}));const o=String(a);return o!==e?o:void 0}(n,e,r,t);void 0!==a&&(t?e.cloneBefore({value:a}):e.value=a)}}};j.postcss=!0;const $=e=>{const t=Object.assign({preserve:!1,enableProgressiveCustomProperties:!0},e);return t.enableProgressiveCustomProperties&&t.preserve?{postcssPlugin:"postcss-color-function",plugins:[n.default(),j(t)]}:j(t)};$.postcss=!0,module.exports=$;
