import e from"postcss-selector-parser";function s(e){e&&e.nodes&&e.nodes.sort(((e,s)=>{if("selector"===e.type&&"selector"===s.type&&e.nodes.length&&s.nodes.length){if(e.nodes[0].type===s.nodes[0].type)return 0;if(n[e.nodes[0].type]<n[s.nodes[0].type])return-1;if(n[e.nodes[0].type]>n[s.nodes[0].type])return 1}if("selector"===e.type&&e.nodes.length){if(e.nodes[0].type===s.type)return 0;if(n[e.nodes[0].type]<n[s.type])return-1;if(n[e.nodes[0].type]>n[s.type])return 1}if("selector"===s.type&&s.nodes.length){if(e.type===s.nodes[0].type)return 0;if(n[e.type]<n[s.nodes[0].type])return-1;if(n[e.type]>n[s.nodes[0].type])return 1}return e.type===s.type?0:n[e.type]<n[s.type]?-1:1}))}const n={universal:0,tag:1,id:2,class:3,attribute:4,pseudo:5,selector:7,string:8,root:9,comment:10};function o(n,o,t){return n.flatMap((n=>{if(-1===n.indexOf(":-csstools-matches")&&-1===n.indexOf(":is"))return n;const r=e().astSync(n);return r.walkPseudos((s=>{if(":is"===s.value&&s.nodes&&s.nodes.length&&"selector"===s.nodes[0].type&&0===s.nodes[0].nodes.length)return s.value=":not",void s.nodes[0].append(e.universal());if(":-csstools-matches"===s.value)if(!s.nodes||s.nodes.length){if(1===s.nodes.length&&"selector"===s.nodes[0].type){if(1===s.nodes[0].nodes.length)return void s.replaceWith(s.nodes[0].nodes[0]);if(!s.nodes[0].some((e=>"combinator"===e.type)))return void s.replaceWith(...s.nodes[0].nodes)}1!==r.nodes.length||"selector"!==r.nodes[0].type||1!==r.nodes[0].nodes.length||r.nodes[0].nodes[0]!==s?function(e){return!(!e||!e.nodes||"selector"!==e.type||3!==e.nodes.length||!e.nodes[0]||"pseudo"!==e.nodes[0].type||":-csstools-matches"!==e.nodes[0].value||!e.nodes[1]||"combinator"!==e.nodes[1].type||"+"!==e.nodes[1].value||!e.nodes[2]||"pseudo"!==e.nodes[2].type||":-csstools-matches"!==e.nodes[2].value||!e.nodes[0].nodes||1!==e.nodes[0].nodes.length||"selector"!==e.nodes[0].nodes[0].type||!e.nodes[0].nodes[0].nodes||3!==e.nodes[0].nodes[0].nodes.length||!e.nodes[0].nodes[0].nodes||"combinator"!==e.nodes[0].nodes[0].nodes[1].type||">"!==e.nodes[0].nodes[0].nodes[1].value||!e.nodes[2].nodes||1!==e.nodes[2].nodes.length||"selector"!==e.nodes[2].nodes[0].type||!e.nodes[2].nodes[0].nodes||3!==e.nodes[2].nodes[0].nodes.length||!e.nodes[2].nodes[0].nodes||"combinator"!==e.nodes[2].nodes[0].nodes[1].type||">"!==e.nodes[2].nodes[0].nodes[1].value||(e.nodes[0].nodes[0].insertAfter(e.nodes[0].nodes[0].nodes[0],e.nodes[2].nodes[0].nodes[0].clone()),e.nodes[2].nodes[0].nodes[1].remove(),e.nodes[2].nodes[0].nodes[0].remove(),e.nodes[0].replaceWith(e.nodes[0].nodes[0]),e.nodes[2].replaceWith(e.nodes[2].nodes[0]),0))}(s.parent)||function(e){if(!e||!e.nodes)return!1;if("selector"!==e.type)return!1;if(2!==e.nodes.length)return!1;let s,n;return e.nodes[0]&&"pseudo"===e.nodes[0].type&&":-csstools-matches"===e.nodes[0].value?(s=0,n=1):e.nodes[1]&&"pseudo"===e.nodes[1].type&&":-csstools-matches"===e.nodes[1].value&&(s=1,n=0),!(!s||!e.nodes[n]||"selector"===e.nodes[n].type&&e.nodes[n].some((e=>"combinator"===e.type))||(e.nodes[s].append(e.nodes[n].clone()),e.nodes[s].replaceWith(...e.nodes[s].nodes),e.nodes[n].remove(),0))}(s.parent)||("warning"===o.onComplexSelector&&t(),s.value=":is"):s.replaceWith(...s.nodes[0].nodes)}else s.remove()})),r.walk((e=>{"selector"===e.type&&"nodes"in e&&1===e.nodes.length&&"selector"===e.nodes[0].type&&e.replaceWith(e.nodes[0])})),r.walk((n=>{"nodes"in n&&function(n){if(!n||!n.nodes)return;let o=[];const t=[...n.nodes];for(let n=0;n<t.length+1;n++){const r=t[n];if(r&&"combinator"!==r.type)o.push(r);else{if(o.length>1){const n=e.selector({value:""});o[0].replaceWith(n),o.slice(1).forEach((e=>{e.remove()})),o.forEach((e=>{n.append(e)})),s(n),n.replaceWith(...n.nodes)}o=[]}}}(n)})),r.toString()})).filter((e=>!!e))}function t(s){let n=0,o=0,r=0;if("universal"==s.type)return{a:0,b:0,c:0};if("id"===s.type)n+=1;else if("tag"===s.type)r+=1;else if("class"===s.type)o+=1;else if("attribute"===s.type)o+=1;else if("pseudo"===s.type)switch(s.value){case"::after":case":after":case"::backdrop":case"::before":case":before":case"::cue":case"::cue-region":case"::first-letter":case":first-letter":case"::first-line":case":first-line":case"::file-selector-button":case"::grammar-error":case"::marker":case"::part":case"::placeholder":case"::selection":case"::slotted":case"::spelling-error":case"::target-text":r+=1;break;case":is":case":has":case":not":if(s.nodes&&s.nodes.length>0){let e={a:0,b:0,c:0};s.nodes.forEach((s=>{const n=t(s);n.a>e.a?e=n:n.a<e.a||(n.b>e.b?e=n:n.b<e.b||n.c>e.c&&(e=n))})),n+=e.a,o+=e.b,r+=e.c}break;case"where":break;case":nth-child":case":nth-last-child":{const d=s.nodes.findIndex((e=>{e.value}));if(d>-1){const c=t(e.selector({nodes:s.nodes.slice(d+1),value:""}));n+=c.a,o+=c.b,r+=c.c}else n+=n,o+=o,r+=r}break;default:o+=1}else s.nodes&&s.nodes.length>0&&s.nodes.forEach((e=>{const s=t(e);n+=s.a,o+=s.b,r+=s.c}));return{a:n,b:o,c:r}}function r(s,n,o=0){const d=":not(#"+n.specificityMatchingName+")",c=":not(."+n.specificityMatchingName+")",l=":not("+n.specificityMatchingName+")";return s.flatMap((s=>{if(-1===s.indexOf(":is"))return s;let a=!1;const i=[];if(e().astSync(s).walkPseudos((e=>{if(":is"!==e.value||!e.nodes||!e.nodes.length)return;if("selector"===e.nodes[0].type&&0===e.nodes[0].nodes.length)return;let s=e.parent;for(;s;){if(":is"===s.value&&"pseudo"===s.type)return void(a=!0);s=s.parent}const n=t(e),o=e.sourceIndex,r=o+e.toString().length,p=[];e.nodes.forEach((e=>{const s={start:o,end:r,option:""},a=t(e);let i=e.toString().trim();const f=Math.max(0,n.a-a.a),u=Math.max(0,n.b-a.b),h=Math.max(0,n.c-a.c);for(let e=0;e<f;e++)i+=d;for(let e=0;e<u;e++)i+=c;for(let e=0;e<h;e++)i+=l;s.option=i,p.push(s)})),i.push(p)})),!i.length)return[s];let p=[];return function(...e){const s=[],n=e.length-1;function o(t,r){for(let d=0,c=e[r].length;d<c;d++){const c=t.slice(0);c.push(e[r][d]),r==n?s.push(c):o(c,r+1)}}return o([],0),s}(...i).forEach((e=>{let n="";for(let t=0;t<e.length;t++){var o;const r=e[t];n+=s.substring((null==(o=e[t-1])?void 0:o.end)||0,e[t].start),n+=":-csstools-matches("+r.option+")",t===e.length-1&&(n+=s.substring(e[t].end))}p.push(n)})),a&&o<10&&(p=r(p,n,o+1)),p})).filter((e=>!!e))}const d=e=>{const s={specificityMatchingName:"does-not-exist",...e||{}};return{postcssPlugin:"postcss-is-pseudo-class",Rule(e,{result:n}){if(!e.selector)return;if(-1===e.selector.indexOf(":is"))return;let t=!1;const d=()=>{"warning"===s.onComplexSelector&&(t||(t=!0,e.warn(n,`Complex selectors in '${e.selector}' can not be transformed to an equivalent selector without ':is()'.`)))};try{let n=!1;const t=[],c=o(r(e.selectors,{specificityMatchingName:s.specificityMatchingName}),{onComplexSelector:s.onComplexSelector},d);if(Array.from(new Set(c)).forEach((s=>{e.selectors.indexOf(s)>-1?t.push(s):(e.cloneBefore({selector:s}),n=!0)})),t.length&&n&&e.cloneBefore({selectors:t}),!s.preserve){if(!n)return;e.remove()}}catch(s){if(s.message.indexOf("call stack size exceeded")>-1)throw s;e.warn(n,`Failed to parse selector "${e.selector}"`)}}}};d.postcss=!0;export{d as default};
