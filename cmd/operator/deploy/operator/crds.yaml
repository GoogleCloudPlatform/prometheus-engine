# Copyright 2021 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     https:#www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: podmonitorings.monitoring.googleapis.com
spec:
  group: monitoring.googleapis.com
  names:
    kind: PodMonitoring
    plural: podmonitorings
  versions:
    - name: v1alpha1
      subresources:
        status: {}
      served: true
      storage: true
      additionalPrinterColumns:
        - name: status
          jsonPath: .status.conditions[*].type
          type: string
      "schema":
        "openAPIV3Schema":
          description: PodMonitoring defines monitoring for a set of pods.
          type: object
          required:
            - spec
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            spec:
              description: Specification of desired Pod selection for target discovery by Prometheus.
              type: object
              required:
                - endpoints
                - selector
              properties:
                endpoints:
                  type: array
                  items:
                    description: ScrapeEndpoint specifies a Prometheus metrics endpoint to scrape.
                    type: object
                    properties:
                      interval:
                        description: Interval at which to scrape metrics. Must be a valid Prometheus duration.
                        type: string
                      path:
                        description: HTTP path to scrape metrics from. Defaults to "/metrics".
                        type: string
                      port:
                        description: Name or number of the port to scrape.
                        anyOf:
                          - type: integer
                          - type: string
                        x-kubernetes-int-or-string: true
                      timeout:
                        description: Timeout for metrics scrapes. Must be a valid Prometheus duration. Must not be larger then the scrape interval.
                        type: string
                selector:
                  description: A label selector is a label query over a set of resources. The result of matchLabels and matchExpressions are ANDed. An empty label selector matches all objects. A null label selector matches no objects.
                  type: object
                  properties:
                    matchExpressions:
                      description: matchExpressions is a list of label selector requirements. The requirements are ANDed.
                      type: array
                      items:
                        description: A label selector requirement is a selector that contains values, a key, and an operator that relates the key and values.
                        type: object
                        required:
                          - key
                          - operator
                        properties:
                          key:
                            description: key is the label key that the selector applies to.
                            type: string
                          operator:
                            description: operator represents a key's relationship to a set of values. Valid operators are In, NotIn, Exists and DoesNotExist.
                            type: string
                          values:
                            description: values is an array of string values. If the operator is In or NotIn, the values array must be non-empty. If the operator is Exists or DoesNotExist, the values array must be empty. This array is replaced during a strategic merge patch.
                            type: array
                            items:
                              type: string
                    matchLabels:
                      description: matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels map is equivalent to an element of matchExpressions, whose key field is "key", the operator is "In", and the values array contains only "value". The requirements are ANDed.
                      type: object
                      additionalProperties:
                        type: string
                targetLabels:
                  description: TargetLabels groups label mappings by Kubernetes resource.
                  type: object
                  properties:
                    fromPod:
                      description: 'Labels to transfer from the Kubernetes Pod to Prometheus target labels. In the case of a label mapping conflict: - Mappings at the end of the array take precedence.'
                      type: array
                      items:
                        description: LabelMapping specifies how to transfer a label from a Kubernetes resource onto a Prometheus target.
                        type: object
                        required:
                          - from
                        properties:
                          from:
                            description: Kubenetes resource label to remap.
                            type: string
                          to:
                            description: Remapped Prometheus target label. Defaults to the same name as `From`.
                            type: string
            status:
              description: Most recently observed status of the resource.
              type: object
              properties:
                conditions:
                  description: Represents the latest available observations of a podmonitor's current state.
                  type: array
                  items:
                    description: MonitoringCondition describes a condition of a PodMonitoring.
                    type: object
                    required:
                      - status
                      - type
                    properties:
                      lastTransitionTime:
                        description: Last time the condition transitioned from one status to another.
                        type: string
                        format: date-time
                      lastUpdateTime:
                        description: The last time this condition was updated.
                        type: string
                        format: date-time
                      message:
                        description: A human-readable message indicating details about the transition.
                        type: string
                      reason:
                        description: The reason for the condition's last transition.
                        type: string
                      status:
                        description: Status of the condition, one of True, False, Unknown.
                        type: string
                      type:
                        description: MonitoringConditionType is the type of MonitoringCondition.
                        type: string
                observedGeneration:
                  description: The generation observed by the controller.
                  type: integer
                  format: int64
  scope: Namespaced
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: rules.monitoring.googleapis.com
spec:
  group: monitoring.googleapis.com
  names:
    kind: Rules
    plural: rules
  versions:
    - name: v1alpha1
      subresources:
        status: {}
      served: true
      storage: true
      "schema":
        "openAPIV3Schema":
          description: Rules defines Prometheus alerting and recording rules that are scoped to the namespace of the resource. Only metric data from this namespace is processed and all rule results have their project_id, cluster, and namespace label preserved query processing. The location, if not preserved by the rule, is set to the cluster's location.
          type: object
          required:
            - spec
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            spec:
              description: Specification of desired Pod selection for target discovery by Prometheus.
              type: object
              required:
                - groups
              properties:
                groups:
                  description: A list of Prometheus rule groups.
                  type: array
                  items:
                    description: 'RuleGroup declares rules in the Prometheus format: https://prometheus.io/docs/prometheus/latest/configuration/recording_rules/'
                    type: object
                    required:
                      - interval
                      - name
                      - rules
                    properties:
                      interval:
                        description: The interval at which to evaluate the rules. Must be a valid Prometheus duration.
                        type: string
                      name:
                        description: The name of the rule group.
                        type: string
                      rules:
                        description: A list of rules that are executed sequentially as part of this group.
                        type: array
                        items:
                          description: 'Rule is a single rule in the Prometheus format: https://prometheus.io/docs/prometheus/latest/configuration/recording_rules/'
                          type: object
                          required:
                            - expr
                          properties:
                            alert:
                              description: Name of the alert to evaluate the expression as. Only one of `record` and `alert` must be set.
                              type: string
                            annotations:
                              description: A set of annotations to attach to alerts produced by the query expression. Only valid if `alert` is set.
                              type: object
                              additionalProperties:
                                type: string
                            expr:
                              description: The PromQL expression to evaluate.
                              type: string
                            for:
                              description: The duration to wait before a firing alert produced by this rule is sent to Alertmanager. Only valid if `alert` is set.
                              type: string
                            labels:
                              description: A set of labels to attach to the result of the query expression.
                              type: object
                              additionalProperties:
                                type: string
                            record:
                              description: Record the result of the expression to this metric name. Only one of `record` and `alert` must be set.
                              type: string
            status:
              description: Most recently observed status of the resource.
              type: object
  scope: Namespaced
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: clusterrules.monitoring.googleapis.com
spec:
  group: monitoring.googleapis.com
  names:
    kind: ClusterRules
    plural: clusterrules
  versions:
    - name: v1alpha1
      subresources:
        status: {}
      served: true
      storage: true
      "schema":
        "openAPIV3Schema":
          description: ClusterRules defines Prometheus alerting and recording rules that are scoped to the current cluster. Only metric data from the current cluster is processed and all rule results have their project_id and cluster label preserved preserved query processing. The location, if not preserved by the rule, is set to the cluster's location
          type: object
          required:
            - spec
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            kind:
              description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            spec:
              description: Specification of desired Pod selection for target discovery by Prometheus.
              type: object
              required:
                - groups
              properties:
                groups:
                  description: A list of Prometheus rule groups.
                  type: array
                  items:
                    description: 'RuleGroup declares rules in the Prometheus format: https://prometheus.io/docs/prometheus/latest/configuration/recording_rules/'
                    type: object
                    required:
                      - interval
                      - name
                      - rules
                    properties:
                      interval:
                        description: The interval at which to evaluate the rules. Must be a valid Prometheus duration.
                        type: string
                      name:
                        description: The name of the rule group.
                        type: string
                      rules:
                        description: A list of rules that are executed sequentially as part of this group.
                        type: array
                        items:
                          description: 'Rule is a single rule in the Prometheus format: https://prometheus.io/docs/prometheus/latest/configuration/recording_rules/'
                          type: object
                          required:
                            - expr
                          properties:
                            alert:
                              description: Name of the alert to evaluate the expression as. Only one of `record` and `alert` must be set.
                              type: string
                            annotations:
                              description: A set of annotations to attach to alerts produced by the query expression. Only valid if `alert` is set.
                              type: object
                              additionalProperties:
                                type: string
                            expr:
                              description: The PromQL expression to evaluate.
                              type: string
                            for:
                              description: The duration to wait before a firing alert produced by this rule is sent to Alertmanager. Only valid if `alert` is set.
                              type: string
                            labels:
                              description: A set of labels to attach to the result of the query expression.
                              type: object
                              additionalProperties:
                                type: string
                            record:
                              description: Record the result of the expression to this metric name. Only one of `record` and `alert` must be set.
                              type: string
            status:
              description: Most recently observed status of the resource.
              type: object
  scope: Cluster
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: operatorconfigs.monitoring.googleapis.com
spec:
  group: monitoring.googleapis.com
  names:
    kind: OperatorConfig
    plural: operatorconfigs
  versions:
    - name: v1alpha1
      served: true
      storage: true
      "schema":
        "openAPIV3Schema":
          description: OperatorConfig defines configuration of the gmp-operator.
          type: object
          properties:
            apiVersion:
              description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
              type: string
            collection:
              description: Collection specifies how the operator configures collection.
              type: object
              properties:
                credentials:
                  description: A reference to GCP service account credentials with which Prometheus collectors are run. It needs to have metric write permissions for all project IDs to which data is written. Within GKE, this can typically be left empty if the compute default service account has the required permissions.
                  type: object
                  required:
                    - key
                  properties:
                    key:
                      description: The key of the secret to select from.  Must be a valid secret key.
                      type: string
                    name:
                      description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names TODO: Add other useful fields. apiVersion, kind, uid?'
                      type: string
                    optional:
                      description: Specify whether the Secret or its key must be defined
                      type: boolean
                externalLabels:
                  description: ExternalLabels specifies external labels that are attached to all scraped data before being written to Cloud Monitoring. The precedence behavior matches that of Prometheus.
                  type: object
                  additionalProperties:
                    type: string
                filter:
                  description: Filter limits which metric data is sent to Cloud Monitoring.
                  type: object
                  properties:
                    matchOneOf:
                      description: "A list Prometheus time series matchers. Every time series must match at least one of the matchers to be exported. This field can be used equivalently to the match[] parameter of the Prometheus federation endpoint to selectively export data. \n Example: `[\"{job='prometheus'}\", \"{__name__=~'job:.*'}\"]`"
                      type: array
                      items:
                        type: string
            kind:
              description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
              type: string
            metadata:
              type: object
            rules:
              description: Rules specifies how the operator configures and deployes rule-evaluator.
              type: object
              properties:
                alerting:
                  description: Alerting contains how the rule-evaluator configures alerting.
                  type: object
                  properties:
                    alertmanagers:
                      description: Alertmanagers contains endpoint configuration for designated Alertmanagers.
                      type: array
                      items:
                        description: AlertmanagerEndpoints defines a selection of a single Endpoints object containing alertmanager IPs to fire alerts against.
                        type: object
                        required:
                          - name
                          - namespace
                          - port
                        properties:
                          apiVersion:
                            description: Version of the Alertmanager API that rule-evaluator uses to send alerts. It can be "v1" or "v2".
                            type: string
                          authorization:
                            description: Authorization section for this alertmanager endpoint
                            type: object
                            properties:
                              credentials:
                                description: The secret's key that contains the credentials of the request
                                type: object
                                required:
                                  - key
                                properties:
                                  key:
                                    description: The key of the secret to select from.  Must be a valid secret key.
                                    type: string
                                  name:
                                    description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names TODO: Add other useful fields. apiVersion, kind, uid?'
                                    type: string
                                  optional:
                                    description: Specify whether the Secret or its key must be defined
                                    type: boolean
                              type:
                                description: Set the authentication type. Defaults to Bearer, Basic will cause an error
                                type: string
                          name:
                            description: Name of Endpoints object in Namespace.
                            type: string
                          namespace:
                            description: Namespace of Endpoints object.
                            type: string
                          pathPrefix:
                            description: Prefix for the HTTP path alerts are pushed to.
                            type: string
                          port:
                            description: Port the Alertmanager API is exposed on.
                            anyOf:
                              - type: integer
                              - type: string
                            x-kubernetes-int-or-string: true
                          scheme:
                            description: Scheme to use when firing alerts.
                            type: string
                          timeout:
                            description: Timeout is a per-target Alertmanager timeout when pushing alerts.
                            type: string
                          tls:
                            description: TLS Config to use for alertmanager connection.
                            type: object
                            properties:
                              ca:
                                description: Struct containing the CA cert to use for the targets.
                                type: object
                                properties:
                                  configMap:
                                    description: ConfigMap containing data to use for the targets.
                                    type: object
                                    required:
                                      - key
                                    properties:
                                      key:
                                        description: The key to select.
                                        type: string
                                      name:
                                        description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names TODO: Add other useful fields. apiVersion, kind, uid?'
                                        type: string
                                      optional:
                                        description: Specify whether the ConfigMap or its key must be defined
                                        type: boolean
                                  secret:
                                    description: Secret containing data to use for the targets.
                                    type: object
                                    required:
                                      - key
                                    properties:
                                      key:
                                        description: The key of the secret to select from.  Must be a valid secret key.
                                        type: string
                                      name:
                                        description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names TODO: Add other useful fields. apiVersion, kind, uid?'
                                        type: string
                                      optional:
                                        description: Specify whether the Secret or its key must be defined
                                        type: boolean
                              cert:
                                description: Struct containing the client cert file for the targets.
                                type: object
                                properties:
                                  configMap:
                                    description: ConfigMap containing data to use for the targets.
                                    type: object
                                    required:
                                      - key
                                    properties:
                                      key:
                                        description: The key to select.
                                        type: string
                                      name:
                                        description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names TODO: Add other useful fields. apiVersion, kind, uid?'
                                        type: string
                                      optional:
                                        description: Specify whether the ConfigMap or its key must be defined
                                        type: boolean
                                  secret:
                                    description: Secret containing data to use for the targets.
                                    type: object
                                    required:
                                      - key
                                    properties:
                                      key:
                                        description: The key of the secret to select from.  Must be a valid secret key.
                                        type: string
                                      name:
                                        description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names TODO: Add other useful fields. apiVersion, kind, uid?'
                                        type: string
                                      optional:
                                        description: Specify whether the Secret or its key must be defined
                                        type: boolean
                              insecureSkipVerify:
                                description: Disable target certificate validation.
                                type: boolean
                              keySecret:
                                description: Secret containing the client key file for the targets.
                                type: object
                                required:
                                  - key
                                properties:
                                  key:
                                    description: The key of the secret to select from.  Must be a valid secret key.
                                    type: string
                                  name:
                                    description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names TODO: Add other useful fields. apiVersion, kind, uid?'
                                    type: string
                                  optional:
                                    description: Specify whether the Secret or its key must be defined
                                    type: boolean
                              serverName:
                                description: Used to verify the hostname for the targets.
                                type: string
                credentials:
                  description: A reference to GCP service account credentials with which the rule evaluator container is run. It needs to have metric read permissions against queryProjectId and metric write permissions against all projects to which rule results are written. Within GKE, this can typically be left empty if the compute default service account has the required permissions.
                  type: object
                  required:
                    - key
                  properties:
                    key:
                      description: The key of the secret to select from.  Must be a valid secret key.
                      type: string
                    name:
                      description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names TODO: Add other useful fields. apiVersion, kind, uid?'
                      type: string
                    optional:
                      description: Specify whether the Secret or its key must be defined
                      type: boolean
                externalLabels:
                  description: ExternalLabels specifies external labels that are attached to any rule results and alerts produced by rules. The precedence behavior matches that of Prometheus.
                  type: object
                  additionalProperties:
                    type: string
                queryProjectID:
                  description: QueryProjectID is the GCP project ID to evaluate rules against. If left blank, the rule-evaluator will try attempt to infer the Project ID from the environment.
                  type: string
  scope: Namespaced
